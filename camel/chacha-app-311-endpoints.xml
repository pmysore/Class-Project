<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:camel="http://camel.apache.org/schema/spring"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
	   					   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	   					   http://camel.apache.org/schema/spring
						   http://camel.apache.org/schema/spring/camel-spring-2.8.1.xsd">

	<camel:camelContext id="camelContext">
		<camel:propertyPlaceholder id="routeProps" location="ref:configProps"/>
		<camel:package>com.chacha.threeeleven.routing</camel:package>
		<camel:template id="producerTemplate"/>
	</camel:camelContext>

	<!-- Core Broker -->
	<bean id="coreConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
		<property name="brokerURL" value="${311-defaultBrokerUrl}"/>
	</bean>

	<bean id="corePooledConnectionFactory" class="org.apache.activemq.pool.PooledConnectionFactory" init-method="start" destroy-method="stop">
		<property name="maxConnections" value="${311-defaultBrokerUrl.connections.max}"/>
		<property name="maximumActive" value="500"/>
		<property name="connectionFactory" ref="coreConnectionFactory"/>
	</bean>

	<bean id="coreJmsConfig" class="org.apache.camel.component.jms.JmsConfiguration">
		<property name="connectionFactory" ref="corePooledConnectionFactory"/>
		<property name="transacted" value="false"/>
		<property name="deliveryPersistent" value="false"/>
	</bean>

	<bean id="activemq" class="org.apache.activemq.camel.component.ActiveMQComponent">
		<property name="configuration" ref="coreJmsConfig"/>
	</bean>
 
 <bean id="startQuery" class="com.chacha.threeeleven.endpoint.StartQueryEndpoint">
  <property name="mappingLookupDao" ref="mappingLookupDao"/>
  <property name="businessRules" ref="businessRules"/>
  <property name="searchHistoryClient" ref="searchHistoryClient"/>
 </bean>
 
 <bean id="endQuery" class="com.chacha.threeeleven.endpoint.OutboundEnrichmentEndpoint">
  <property name="mappingLookupDao" ref="mappingLookupDao"/>
  <property name="businessRules" ref="businessRules"/>
 </bean>
 
 <bean id="resourceValidator" class="com.chacha.threeeleven.endpoint.AffiliateResourceValidator">
  <property name="mappingLookupDao" ref="mappingLookupDao"/>
 </bean>
  
 <!-- Set producer for all SendMobileMessage commands -->
 <bean class="com.chacha.threeeleven.rules.command.SendMobileMessage">
  <property name="producerTemplate" ref="producerTemplate"/>
  <property name="url" value="${311-sms-producer}"/>
 </bean>

</beans>
